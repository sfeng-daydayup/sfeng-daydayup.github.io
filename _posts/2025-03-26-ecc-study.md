---
layout: post
title: ECC Study
date: 2025-03-26 18:45 +0800
author: sfeng
categories: [Security]
tags: [ECC]
lang: zh
---

## Preface
> The Elliptic Curve Cryptography (ECC) is modern family of public-key cryptosystems, which is based on the algebraic structures of the elliptic curves over finite fields and on the difficulty of the Elliptic Curve Discrete Logarithm Problem (ECDLP).
> The ECC cryptography is considered a natural modern successor of the RSA cryptosystem, because ECC uses smaller keys and signatures than RSA for the same level of security and provides very fast key generation, fast key agreement and fast signatures.
{: .prompt-info }   

&emsp;&emsp;æœ¬ç¯‡ä¸»è¦ç›®çš„æ˜¯å¯¹ECCå»ºç«‹ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œç”±äºé‡Œé¢æ¶‰åŠåˆ°å¾ˆå¤šç®—æ³•çŸ¥è¯†ï¼Œåšä¸»ä¹Ÿä»ç†è§£å®ƒçš„å®ç°å’Œç”¨æ³•ç€æ‰‹ï¼Œæç»˜ECCç®—æ³•çš„ä¸€ä¸ªæ¦‚è²Œã€‚  

## Elliptic Curves
&emsp;&emsp;åœ¨å¯†ç å­¦ä¸­é€‰ç”¨äº†Elliptic Curvesä¸€ç§ç®€å•çš„å½¢å¼ï¼šy<sup>2</sup> = x<sup>3</sup> + ax + bã€‚å…¶ä¸­ä¸åŒçš„aå’Œbçš„å€¼ä¼šå¾—åˆ°ä¸åŒçš„ECCæ›²çº¿ã€‚ä¾‹å¦‚ç”¨äºbitcoinåŠ å¯†çš„ECCæ›²çº¿ä¸ºï¼š  
y<sup>2</sup> = x<sup>3</sup> + 7 ([secp256k1](https://en.bitcoin.it/wiki/Secp256k1))  
&emsp;&emsp;å½“ç„¶å®šä¹‰åœ¨æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿æ–¹ç¨‹è¿˜éœ€è¦å–æ¨¡ã€‚  

&emsp;&emsp;è¿™é‡Œè¦æç¤ºä¸‹ï¼Œå¹¶éæ‰€æœ‰çš„ECCæ›²çº¿éƒ½æœ‰è¶³å¤Ÿçš„å®‰å…¨æ€§æ¥åšåŠ è§£å¯†æˆ–è€…ç­¾åã€‚[è¿™é‡Œ](https://safecurves.cr.yp.to/)åˆ—å‡ºäº†ä¸€äº›ECCæ›²çº¿æ˜¯å¦å®‰å…¨ã€‚  

&emsp;&emsp;è¿˜æœ‰å‡ ä¸ªæ¦‚å¿µéœ€è¦äº†è§£ã€‚  
1. EC point
 å°±æ˜¯æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹ã€‚  
2. Order  
  The order of the curve is the total number of all EC points on the curve.å½“å®šä¹‰åœ¨æœ‰é™åŸŸä¸Šæ—¶ï¼Œæ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹æ˜¯æœ‰é™çš„ï¼Œç‚¹çš„ä¸ªæ•°å°±æ˜¯orderã€‚  
3. Multiplication of EC Points 
  æ‹¿åˆ°ECCæ›²çº¿ä¸Šçš„ä¸€å¯¹æˆ–è€…ä¸€ä¸ªç‚¹ï¼Œå¯ä»¥å¯¹å®ƒï¼ˆä»¬ï¼‰è¿›è¡ŒåŠ å‡å’Œä¹˜ï¼Œå½“ç„¶è¿™ä¸æ˜¯å¹³å¸¸ä»£æ•°æ„ä¹‰ä¸Šçš„åŠ å‡ä¹˜ï¼Œå…·ä½“å¯ä»¥çœ‹[Elliptic_curve_point_multiplication](https://en.wikipedia.org/wiki/Elliptic_curve_point_multiplication)ã€‚  
4. Cofactor  
  Cofactoræ˜¯åœ¨#3çš„è®¡ç®—ä¸‹ï¼Œå¯ä»¥ä»æŸä¸ªç‚¹å¼€å§‹å¯¼å‡ºåœ¨è¯¥ECCæ›²çº¿ä¸Šéƒ¨åˆ†æˆ–è€…æ‰€æœ‰ç‚¹çš„é›†åˆã€‚æœ‰çš„æ›²çº¿åªå­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„é›†åˆï¼Œè€Œä¹Ÿå¯èƒ½æœ‰å¤šä¸ªè¿™æ ·çš„é›†åˆã€‚Cofactorå°±æ˜¯é›†åˆçš„ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼š  
  secp256k1 cofactor = 1  
  Curve25519 cofactor = 8  
  Curve448 cofactor = 4  
 è¿™äº›å­é›†è¦æ±‚äº’ç›¸ä¸é‡å¤ï¼Œå®ƒä»¬å…±åŒç»„æˆäº†æ•´ä¸ªæ›²çº¿ä¸Šorderä¸ªEC pointsã€‚  
5. Generator Point  
  ä¸Šé¢è¯´å­é›†ä¸é‡åˆï¼Œå¹¶éæ‰€æœ‰çš„EC pointéƒ½å¯ä»¥åšåˆ°ï¼Œä¸Šè¿°å­é›†ä¸­ä»»å–ä¸€ä¸ªç‚¹åšMultiplicationæ“ä½œå¾—åˆ°çš„å¾ˆå¯èƒ½æ˜¯è¯¥å­é›†çš„å­é›†ï¼Œé‚£å¾—åˆ°çš„é›†åˆæ°æ°æ˜¯è¿™ä¸ªå­é›†çš„å°±å«è¿™ä¸ªsubgroupçš„generator pointã€‚  
  ä¸€èˆ¬æƒ…å†µä¸‹Generator pointä¼šæœ‰å¾ˆå¤šä¸ªï¼Œå½“é€‰ç”¨è¯¥ECC Curveå¹¶è®¾è®¡ç®—æ³•æ—¶ï¼Œè¦è°¨æ…é€‰å–è¿™ä¸ªç‚¹ä»¥å¾—åˆ°æ›´å¥½æ€§èƒ½ã€‚è¿™ä¸ªç‚¹ä¸€èˆ¬å«åšâ€œGâ€ã€‚  
6. Private Key  
  åœ¨RSAä¸­é¦–å…ˆè¦æ‰¾åˆ°ä¸€å¯¹å¤§ç´ æ•°æ¥ç”Ÿæˆç§é’¥å…¬é’¥ï¼ŒECCä¸­çš„ç§é’¥åˆ™æ˜¯ä¸€ä¸ªéšæœºæ•°ã€‚å”¯ä¸€è¦æ±‚å°±æ˜¯è¦å°äºorderï¼Œå½“ç„¶è€ƒè™‘å®‰å…¨æ€§ï¼Œä½æ•°è¦è¶³å¤Ÿå¤šï¼Œæ¯”å¦‚256 bitsã€‚  
7. Public Key  
  Public Keyæ˜¯å¯¹Gåšprivate keyæ¬¡åŠ ç”Ÿæˆï¼Œè¡¨ç¤ºä¸º P = (private key) * Gã€‚  

&emsp;&emsp;OKï¼Œè¿™äº›åŸºæœ¬å…ƒç´ é½äº†ï¼Œæ€»ç»“ä¸‹ï¼ˆæ‘˜æŠ„ä¸‹ï¼Œå˜¿å˜¿ï¼‰ï¼Œä¸€ä¸ªECCç®—æ³•åŒ…å«ä¸‹é¢å‡ ä¸ªå…ƒç´ ï¼š  
- Ğ•lliptic curve (EC) over finite field ğ”½p  
  - cofactor
  - n order
  - p mod
  - a rom_lib_ecc_verify of x
  - b constant
- G == generator point (fixed constant, a base point on the EC)  
- k == private key (integer) éšæœºç”Ÿæˆ  
- P == public key (point)  P = k * Gï¼ˆç”±äºECDLPï¼Œå¾ˆéš¾ç”±På€’æ¨å‡ºkï¼‰  

&emsp;&emsp;è¯´åˆ°å¾ˆéš¾æ¨å‡ºkï¼Œæ¶‰åŠåˆ°Curve Security Strengthã€‚è¿™é‡Œå¯ä»¥ç®€å•çš„è®¤ä¸ºå®ƒå°±æ˜¯kçš„é•¿åº¦çš„ä¸€åŠã€‚ä¹Ÿå°±æ˜¯keyä¸º256 bitsæ—¶ï¼Œå®ƒçš„Security Strengthå¤§çº¦ä¸º128 bitsã€‚  

## How to Sign and Verify

&emsp;&emsp;è¿™ä¸ªè¿‡ç¨‹å°±æŠ„äº†ï¼Œå“ˆå“ˆã€‚  

### Generate Signature  
1. ç”Ÿæˆä¸€ä¸ªéšæœºæ•° k1ï¼Œå®ƒä¹Ÿæ˜¯å°äºorderå°±å¥½  
2. åˆ©ç”¨ P1 = k1 * G è®¡ç®—å‡ºç‚¹ P1  
3. P1 ç‚¹çš„ x åæ ‡å®šä¹‰ä¸ºR  
4. å¯¹éœ€è¦ç­¾åçš„æ•°æ®è®¡ç®—hashï¼Œè®°ä¸º H  
5. è®¡ç®—S = k1<sup>-1</sup> (H + k0 * R) mod p ï¼Œè¿™ä¸ªpæ˜¯ä¸Šæ–‡æåˆ°çš„æ¨¡è¿ç®—çš„åº•

&emsp;&emsp;æœ€ç»ˆçš„ç­¾åä¸ºRï¼ˆ20å­—èŠ‚ï¼‰+ Sï¼ˆ20å­—èŠ‚ï¼‰ï¼Œæ€»å…±40å­—èŠ‚ã€‚  

### Verify Signature  
&emsp;&emsp;éªŒç­¾ç”¨ä¸‹é¢çš„å…¬å¼ï¼š  
P2 = S<sup>-1</sup> * H * G + S<sup>-1</sup> * R * P (å…¶ä¸­Pæ˜¯å…¬é’¥ï¼Œ Så’ŒRå…±åŒç»„æˆç­¾åï¼ŒGæ˜¯generator pointerï¼ŒHæ˜¯æ•°æ®hash)  

&emsp;&emsp;å¦‚æœP2çš„æ¨ªåæ ‡ç­‰äºRï¼Œåˆ™éªŒç­¾æˆåŠŸã€‚  

## ECDHï¼ŒECDSAï¼ŒEdDSA and ElGamal

&emsp;&emsp;è¿™å‡ ä¸ªæ¦‚å¿µç»å¸¸ææ··ï¼Œåˆ—åœ¨è¿™é‡Œä»¥å¤‡åæŸ¥ã€‚  
- ECDH (Elliptic Curve Diffie-Hellman)  
  ç”¨åœ¨ä¸¤ä¸ªæœºæ„ä¹‹é—´é€šè¿‡éå®‰å…¨çš„é€šé“åškeyçš„äº¤æ¢ï¼Œè¿™é‡Œçš„keyä¸€èˆ¬æ˜¯å¯¹ç§°å¯†é’¥ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­å¾ˆå®¹æ˜“ç†è§£å•Šï¼Œå°±ç›´æ¥æŠ„è¿‡æ¥äº†ã€‚  
  1. Alice generates a random ECC key pair: {alicePrivKey, alicePubKey = alicePrivKey * G}  
  2. Bob generates a random ECC key pair: {bobPrivKey, bobPubKey = bobPrivKey * G}  
  3. Alice and Bob exchange their public keys through the insecure channel (e.g. over internet)  
  4. Alice calculates sharedKey = bobPubKey * alicePrivKey  
  5. Bob calculates sharedKey = alicePubKey * bobPrivKey  
  6. Now both Alice and Bob have the same sharedKey == bobPubKey * alicePrivKey == alicePubKey * bobPrivKey    
- ECDSA (Elliptic Curve Digital Signature Algorithm)  
  ECDSAåˆ™ç”¨æ¥åšæ•°å­—ç­¾åï¼Œä»¥ä¿è¯æ•°æ®çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ï¼ˆauthenticity and integrityï¼‰ã€‚ä¸RSAæ¯”è¾ƒï¼Œåœ¨è¾¾åˆ°ç›¸åŒlevelçš„securityçš„åŒæ—¶ï¼Œkeyçš„é•¿åº¦æ¯”RSAè¦å°çš„å¤šï¼Œæ‰€ä»¥ç­¾åå’ŒéªŒç­¾çš„é€Ÿåº¦ä¼šå¿«å¾ˆå¤šã€‚  
  æœ€å…¸å‹çš„åº”ç”¨ä¹‹ä¸€æ˜¯ç”¨äºbitcoinçš„secp256k1.  
- EdDSA (Edwards-curve Digital Signature Algorithm)
  åŒECDSAç±»ä¼¼ï¼Œä¸è¿‡åœ¨å®‰å…¨æ€§å’Œæ€§èƒ½ä¸Šæœ‰äº›ä¼˜åŠ¿ã€‚æ¯”å¦‚Ed25519å’ŒEd448ã€‚  
- ElGAmal
  æ—¢å¯ä»¥ç”¨æ¥åškey exchangeï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åšç­¾åã€‚ä¸è¿‡ç›¸æ¯”ECDHå’ŒECDSAä¸æ˜¯å¾ˆå¸¸ç”¨ã€‚  

&emsp;&emsp;å…³äºECCï¼Œå°±å…ˆæ€»ç»“è¿™ä¹ˆå¤šå§ã€‚  

## Reference
[**Elliptic Curve Cryptography**](https://cryptobook.nakov.com/asymmetric-key-ciphers/elliptic-curve-cryptography-ecc)  
[**ECC-zhihu**](https://www.zhihu.com/question/267039333/answer/3279835380)  
[**ECC-wiki**](https://en.wikipedia.org/wiki/Elliptic-curve_cryptography)  
[**Online Elliptic Curve Visualization Tool**](https://www.desmos.com/calculator/ialhd71we3)  
[**Multiplication of EC Points**](https://en.wikipedia.org/wiki/Elliptic_curve_point_multiplication)  
[**ECDH Key Exchange**](https://cryptobook.nakov.com/asymmetric-key-ciphers/ecdh-key-exchange)  
